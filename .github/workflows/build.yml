name: Build GitHub pages

on:
  push:
    branches:
      - gh-pages-src

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
        with:
          path: "repo"

      - name: Checkout redok
        uses: actions/checkout@v2
        with:
          repository: "Aurel300/redok"
          path: "repo/redok"

      - name: Install dependencies
        uses: bahmutov/npm-install@v1
        with:
          working-directory: "repo/redok"

      - name: Build manual
        run: |
          mkdir -p repo/build
          cd repo/redok
          cp ../config.json5 .
          node build.js

      - name: Copy fonts
        run: |
          mkdir repo/build/css
          cp repo/redok/assets/fonts/* repo/build/css

      - name: Build CSS
        uses: gha-utilities/sass-build@v0.2.9
        with:
          source: "repo/redok/assets/style.scss"
          destination: "repo/build/css/style.css"

      - name: Publish to GitHub pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: "./repo/build"
