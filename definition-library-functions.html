<!DOCTYPE html><html><head>
	<title>Functions – ammer manual</title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="css/style.css" media="all">
	<link rel="stylesheet" href="css/highlight.css" media="all">
	<script src="search.js"></script>
</head><body>
	<header><a href="index.html"><h1>ammer</h1></a></header>
	<nav id="menu">
		<input autocomplete="off" tabindex="0" title="Click here to search" id="search" type="text" placeholder="Enter search term here">
		<label for="search"></label>
		<div class="menu-split"></div>
		<div class="menu-split show"><ul><li><a href="index.html">Introduction</a></li><ul><li><a href="intro-overview.html">Overview</a></li></ul><ul><li><a href="intro-terminology.html">Terminology</a></li></ul><ul><li><a href="intro-use.html">Why <code>ammer</code>?</a></li></ul><ul><li><a href="intro-installation.html">Installation</a></li></ul><ul><li><a href="intro-start.html">Getting started</a></li></ul></ul><ul><li><a href="definition.html">Definition</a></li><ul><li><a href="definition-library.html">Library definition</a></li><ul><li><a href="definition-library-functions.html">Functions</a></li></ul><ul><li><a href="definition-library-variables.html">Variables</a></li></ul><ul><li><a href="definition-sub.html">Sublibraries</a></li></ul></ul><ul><li><a href="definition-type.html">Datatypes</a></li><ul><li><a href="definition-type-opaque.html">Opaque types</a></li></ul><ul><li><a href="definition-type-struct.html">Structs</a></li></ul><ul><li><a href="definition-type-instance.html">Instance methods</a></li></ul><ul><li><a href="definition-type-enum.html">Enums</a></li></ul><ul><li><a href="definition-type-haxe.html">Haxe types</a></li></ul><ul><li><a href="definition-type-callbacks.html">Callbacks</a></li></ul><ul><li><a href="definition-link.html">Linking subdefinitions</a></li></ul></ul></ul><ul><li><a href="configuration.html">Configuration</a></li><ul><li><a href="configuration-providing.html">Providing flags</a></li></ul><ul><li><a href="configuration-project.html">Project-wide configuration</a></li></ul><ul><li><a href="configuration-library.html">Library configuration</a></li></ul></ul><ul><li><a href="target.html">Target details</a></li><ul><li><a href="target-feature-parity.html">Feature parity</a></li></ul><ul><li><a href="target-hxcpp.html">C++</a></li></ul><ul><li><a href="target-cs.html">C#</a></li></ul><ul><li><a href="target-eval.html">Eval</a></li></ul><ul><li><a href="target-hashlink.html">HashLink</a></li></ul><ul><li><a href="target-java.html">Java</a></li></ul><ul><li><a href="target-lua.html">Lua</a></li></ul><ul><li><a href="target-neko.html">Neko</a></li></ul><ul><li><a href="target-nodejs.html">Node.js</a></li></ul><ul><li><a href="target-python.html">Python</a></li></ul></ul><ul><li><a href="ref.html">Reference</a></li><ul><li><a href="ref-ffi.html">FFI types</a></li></ul><ul><li><a href="ref-def.html"><code>ammer.def.*</code> types</a></li></ul><ul><li><a href="ref-lib.html"><code>ammer.Lib</code></a></li></ul><ul><li><a href="ref-flags.html">List of configuration flags</a></li></ul><ul><li><a href="ref-annot.html">List of annotations</a></li></ul></ul><ul><li><a href="amlib.html"><code>amlib</code></a></li></ul><ul><li><a href="advanced.html">Advanced topics</a></li><ul><li><a href="advanced-cycles.html">Type cycles</a></li></ul></ul><ul><li><a href="core.html"><code>ammer-core</code></a></li><ul><li><a href="core-api.html">Interface</a></li></ul><ul><li><a href="core-new-platform.html">Implementing new platforms</a></li></ul></ul></div>
	</nav>
	<main><h2>Functions</h2><p>Functions can be declared in library definitions using <code>public static fuction</code> fields with no function body (similar to Haxe externs).</p>
<div class="example">

<h3>Example: function in library definition</h3><div class="hl"><pre><i class="hl-kw">class</i><i class="hl-other"> </i><i class="hl-decl">Foobar</i><i class="hl-other"> </i><i class="hl-kw">extends</i><i class="hl-other"> </i><a class="hll-ty" href="ref-def.html#library" title="ammer.def.* types / ammer.def.Library"><i class="hl-ty">ammer</i><i class="hl-tyx">.</i><i class="hl-ty">def</i><i class="hl-tyx">.</i><i class="hl-ty">Library</i></a><i class="hl-tyx">&lt;</i><i class="hl-lit">"foobar"</i><i class="hl-tyx">&gt;</i><i class="hl-other"> {
  </i><i class="hl-kw">public</i><i class="hl-other"> </i><i class="hl-kw">static</i><i class="hl-other"> </i><i class="hl-kw">function</i><i class="hl-other"> </i><i class="hl-decl">hello</i><i class="hl-other">(</i><i class="hl-decl">a</i><i class="hl-tyx">:</i><i class="hl-ty">Int</i><i class="hl-other">, </i><i class="hl-decl">b</i><i class="hl-tyx">:</i><i class="hl-ty">String</i><i class="hl-other">)</i><i class="hl-tyx">:</i><i class="hl-ty">Float</i><i class="hl-other">;
}</i></pre></div><p>In this example, <code>hello</code> is a function in the <code>Foobar</code> library. The function maps to the native function <code>double hello(int a, char *b)</code> (in C types).</p>
</div>

<p>All return types and argument types must be written explicitly, since Haxe type inference is not compatible with native libraries. Only a subset of Haxe types can be used. See <a href="ref-ffi.html" title="FFI types">FFI types</a>.</p>
<h3 id="macros">Macros</h3><p>The same <code>public static function</code> syntax can be used to declare C preprocessor macro calls, but the additional metadata <a href="ref-annot.html#c.macrocall" title="List of annotations / @:ammer.c.macroCall"><code>@:ammer.macroCall</code></a> should be applied. Macros which require unusual C syntax may cause a compilation failure: for arbitrary C code expressions, see the <a href="#custom-c" title="Customising the C code">next section</a>.</p>
<h3 id="custom-c">Customising the C code</h3><p>For every method declared in an <code>ammer</code> definition, there is glue code generated which has the following general shape:</p>
<div class="hl"><pre><i>target_return_type func(args...) {
  native_args = ... // "pre": decode arguments from target-specific representation to C
  ... // "prereturn"
  c_return_type _return =
    native_call(native_args...); // "return"
  ... // "post": encode returned value to a target-specific representation, cleanup, return
}</i></pre></div><p>A large part of the function, including its exact signature, depends on the concrete target. However, <code>ammer</code> ensures that the initial part of the function code gets the local variables to the same state on any platform: the local variables <code>_arg0</code>, ..., <code>_argN</code> are of the <a href="ref-ffi.html" title="FFI types">C types</a> corresponding to the declared argument types.</p>
<p>If there is additional code that should be called before the actual native call happens, it can be inserted at the point marked &quot;prereturn&quot; above. This is accomplished with the <a href="ref-annot.html#c.prereturn" title="List of annotations / @:ammer.c.prereturn"><code>@:ammer.c.prereturn</code></a> metadata.</p>
<p>If the native call itself should be replaced with a different C expression, this can be accomplished with the <a href="ref-annot.html#c.return" title="List of annotations / @:ammer.c.return"><code>@:ammer.c.return</code></a> metadata. The substring <code>%CODE%</code> will be replaced in the provided code with the original call expression.</p>
<h3 id="pure-haxe">Pure Haxe functions</h3><p>The <a href="ref-annot.html#haxe" title="List of annotations / @:ammer.haxe"><code>@:ammer.haxe</code></a> metadata can be used to define methods on libraries which are implemented purely in Haxe and have no native counterpart. When this metadata is attached to a method (and <em>only</em> then), it may have a body.</p>
<h3>Metadata applicable to functions</h3><p>Metadata can be used to inject additional C code into the wrapper code, mark functions as macro calls, or provide the native name for a function. See the full metadata descriptions for more information:</p>
<ul>
<li><a href="ref-annot.html#haxe" title="List of annotations / @:ammer.haxe"><code>@:ammer.haxe</code></a></li>
<li><a href="ref-annot.html#c.macrocall" title="List of annotations / @:ammer.c.macroCall"><code>@:ammer.macroCall</code></a></li>
<li><a href="ref-annot.html#native" title="List of annotations / @:ammer.native"><code>@:ammer.native</code></a></li>
<li><a href="ref-annot.html#c.macrocall" title="List of annotations / @:ammer.c.macroCall"><code>@:ammer.c.macroCall</code></a></li>
<li><a href="ref-annot.html#c.prereturn" title="List of annotations / @:ammer.c.prereturn"><code>@:ammer.c.prereturn</code></a></li>
<li><a href="ref-annot.html#c.return" title="List of annotations / @:ammer.c.return"><code>@:ammer.c.return</code></a></li>
<li><a href="ref-annot.html#ret.derive" title="List of annotations / @:ammer.ret.derive"><code>@:ammer.ret.derive</code></a></li>
</ul>
<p>The following metadata can be attached to function arguments:</p>
<ul>
<li><a href="ref-annot.html#skip" title="List of annotations / @:ammer.skip"><code>@:ammer.skip</code></a></li>
<li><a href="ref-annot.html#derive" title="List of annotations / @:ammer.derive"><code>@:ammer.derive</code></a></li>
<li><a href="ref-annot.html#c.cast" title="List of annotations / @:ammer.c.cast"><code>@:ammer.c.cast</code></a></li>
</ul>
</main>
	<a id="page-prev" href="definition-library.html">« Previous: Library definition</a>
	<a id="page-next" href="definition-library-variables.html">Next: Variables »</a>
	<footer>
		<a href="https://github.com/Aurel300/ammer/blob/gh-pages-src/content/02-definition.md?plain=1#L48">Contribute to this page</a>
		| <a href="https://github.com/Aurel300/ammer/" target="_blank"><code>ammer</code> on GitHub</a>
		| &copy; 2019-2023 Aurel Bílý
	</footer>
</body></html>